<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Formulario de Pedidos</title>
<style>
body { font-family: Arial, sans-serif; margin:0; background:#f8f0ff; }
header { text-align:center; margin:20px 0; }
header img { max-width:200px; height:auto; }
h1 { text-align:center; color:#6a0dad; margin-bottom:30px; }
form { max-width:1000px; margin:auto; padding:0 15px; }
.seccion { margin-bottom:30px; padding:15px; border-radius:10px; background:rgba(255,255,255,0.85); box-shadow:0 2px 8px rgba(0,0,0,0.1); }
.seccion h2 { margin-bottom:15px; color:#8e44ad; border-bottom:2px solid #8e44ad; padding-bottom:5px; }
.grid-platos { display:grid; grid-template-columns:repeat(auto-fill, minmax(220px,1fr)); gap:15px; }
.plato { background:#fff; padding:10px; border-radius:10px; box-shadow:0 1px 5px rgba(0,0,0,0.1); display:flex; justify-content:space-between; align-items:center; }
.plato input[type="number"] { width:60px; padding:3px; border:1px solid #ccc; border-radius:5px; }
input[type="text"] { width:200px; padding:5px; border-radius:5px; border:1px solid #ccc; }
.botones { text-align:center; margin-top:20px; }
button { background:#8e44ad; color:white; border:none; border-radius:5px; padding:8px 15px; margin:5px; cursor:pointer; font-size:14px; }
button:hover { background:#732d91; }
table { border-collapse: collapse; width: 100%; margin-top: 20px; }
table, th, td { border: 1px solid #ccc; }
th, td { padding: 5px; text-align: left; }
</style>
</head>
<body>
<header><img src="logo.png" alt="Logo"></header>
<h1>Formulario de Pedidos</h1>
<form id="pedidoForm">
<div class="seccion">
<label>Nombre: <input type="text" id="nombre" required></label>
<label>Apellido: <input type="text" id="apellido" required></label>
</div>

<div class="seccion">
<h2>Primeros Platos</h2>
<div class="grid-platos">
<div class="plato">SALPICÓN DE MARISCO <input type="number" id="salpicon" min="0" value="0"></div>
<div class="plato">ENSALADA DE ARROZ <input type="number" id="ensalada_arroz" min="0" value="0"></div>
<div class="plato">ENSALADA ARAGONESA <input type="number" id="ensalada_aragonesa" min="0" value="0"></div>
<div class="plato">REVUELTO DE SETAS CON GAMBAS <input type="number" id="revuelto_setas" min="0" value="0"></div>
<div class="plato">PIMIENTOS RELLENOS DE BACALAO <input type="number" id="pimientos_bacalao" min="0" value="0"></div>
<div class="plato">ENSALADILLA RUSA <input type="number" id="ensaladilla_rusa" min="0" value="0"></div>
<div class="plato">ALUBIAS POCHAS CON BOLETUS <input type="number" id="alubias" min="0" value="0"></div>
<div class="plato">TOSTADA DE VERDURAS CON BONITO <input type="number" id="tostada_bonito" min="0" value="0"></div>
<div class="plato">TOSTADA DE VERDURAS CON ESCABECHADOS <input type="number" id="tostada_escabechados" min="0" value="0"></div>
</div>
</div>

<div class="seccion">
<h2>Segundos Platos</h2>
<div class="grid-platos">
<div class="plato">CAJILLA AL HORNO CON PATATAS <input type="number" id="cajilla" min="0" value="0"></div>
<div class="plato">MORCILLO DE TERNERA CON SETAS <input type="number" id="morcillo" min="0" value="0"></div>
<div class="plato">1/4 DE POLLO TRASERO CON PATATAS <input type="number" id="trasera" min="0" value="0"></div>
<div class="plato">1/2 CODILLO ASADO CON PATATAS <input type="number" id="codillo" min="0" value="0"></div>
<div class="plato">LUBINA AL HORNO CON VERDURAS <input type="number" id="lubina" min="0" value="0"></div>
<div class="plato">CANELONES CASEROS DE CARNE <input type="number" id="canelones" min="0" value="0"></div>
<div class="plato">CALAMARES A LA ANDALUZA CON LIMÓN <input type="number" id="calamares" min="0" value="0"></div>
<div class="plato">BACALAO DOÑA JUANA <input type="number" id="bacalao" min="0" value="0"></div>
<div class="plato">PIERNECITA DE LECHAL <input type="number" id="piernecita" min="0" value="0"></div>
<div class="plato">GORRÍN ASADO <input type="number" id="gorrin" min="0" value="0"></div>
</div>
</div>

<div class="seccion">
<h2>Postres</h2>
<div class="grid-platos">
<div class="plato">FLAN <input type="number" id="flan" min="0" value="0"></div>
<div class="plato">ARROZ CON LECHE <input type="number" id="arroz_leche" min="0" value="0"></div>
<div class="plato">NATILLAS <input type="number" id="natillas" min="0" value="0"></div>
<div class="plato">YOGUR <input type="number" id="yogur" min="0" value="0"></div>
<div class="plato">BROWNIE <input type="number" id="brownie" min="0" value="0"></div>
</div>
</div>

<div class="botones">
<button type="button" onclick="guardarPedido()">Guardar pedido</button>
<button type="button" onclick="exportExcel()">Exportar Excel</button>
<button type="button" onclick="exportPDF()">Exportar PDF</button>
</div>
</form>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script>
const AIRTABLE_API_KEY = 'TU_API_KEY';
const AIRTABLE_BASE_ID = 'TU_BASE_ID';
const AIRTABLE_TABLE = 'Pedidos';

let pedidosGuardados = [];

async function guardarPedido() {
  const nombre = document.getElementById('nombre').value.trim();
  const apellido = document.getElementById('apellido').value.trim();
  if(!nombre || !apellido) { alert('Nombre y Apellido son obligatorios'); return; }

  // Revisar duplicado
  if(pedidosGuardados.some(p => p.Nombre === nombre && p.Apellido === apellido)){
    alert('Pedido duplicado. No se puede guardar.');
    return;
  }

  const pedido = {
    Nombre: nombre,
    Apellido: apellido,
    Salpicon: Number(document.getElementById('salpicon').value),
    EnsaladaArroz: Number(document.getElementById('ensalada_arroz').value),
    EnsaladaAragonesa: Number(document.getElementById('ensalada_aragonesa').value),
    RevueltoSetas: Number(document.getElementById('revuelto_setas').value),
    PimientosBacalao: Number(document.getElementById('pimientos_bacalao').value),
    EnsaladillaRusa: Number(document.getElementById('ensaladilla_rusa').value),
    Alubias: Number(document.getElementById('alubias').value),
    TostadaBonito: Number(document.getElementById('tostada_bonito').value),
    TostadaEscabechados: Number(document.getElementById('tostada_escabechados').value),
    Cajilla: Number(document.getElementById('cajilla').value),
    Morcillo: Number(document.getElementById('morcillo').value),
    Trasera: Number(document.getElementById('trasera').value),
    Codillo: Number(document.getElementById('codillo').value),
    Lubina: Number(document.getElementById('lubina').value),
    Canelones: Number(document.getElementById('canelones').value),
    Calamares: Number(document.getElementById('calamares').value),
    Bacalao: Number(document.getElementById('bacalao').value),
    Piernecita: Number(document.getElementById('piernecita').value),
    Gorrin: Number(document.getElementById('gorrin').value),
    Flan: Number(document.getElementById('flan').value),
    ArrozLeche: Number(document.getElementById('arroz_leche').value),
    Natillas: Number(document.getElementById('natillas').value),
    Yogur: Number(document.getElementById('yogur').value),
    Brownie: Number(document.getElementById('brownie').value)
  };

  // Guardar en Airtable
  await fetch(`https://api.airtable.com/v0/${AIRTABLE_BASE_ID}/${AIRTABLE_TABLE}`, {
    method:'POST',
    headers:{
      'Authorization':'Bearer '+AIRTABLE_API_KEY,
      'Content-Type':'application/json'
    },
    body: JSON.stringify({ fields: pedido })
  });

  pedidosGuardados.push(pedido);
  alert('Pedido guardado correctamente');
  document.getElementById('pedidoForm').reset();
}

function exportExcel() {
  const ws = XLSX.utils.json_to_sheet(pedidosGuardados);
  const wb = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb, ws, "Pedidos");
  XLSX.writeFile(wb, "pedidos.xlsx");
}

function exportPDF() {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();
  let y = 10;
  pedidosGuardados.forEach((p, i) => {
    doc.text(`${i+1}. ${p.Nombre} ${p.Apellido}`, 10, y); y+=6;
    for(let key in p){ if(key!=='Nombre' && key!=='Apellido'){ doc.text(`${key}: ${p[key]}`, 15, y); y+=6; }}
    y+=4; if(y>270){ doc.addPage(); y=10; }
  });
  doc.save('pedidos.pdf');
}
</script>
</body>
</html>
